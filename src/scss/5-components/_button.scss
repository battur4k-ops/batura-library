/* ============================================================
   5-COMPONENTS / _BUTTON.SCSS
   Batura Library | Unified Button v22.0 [Global Physics Sync]
   ============================================================ */

.ui-button {
  --btn-h: var(--ui-h-btn-master);
  --btn-radius: calc(var(--radius-master) * 0.4);
  
  /* [1. IDLE STATE] - Базовый пассив */
  --_bg-op: var(--s-glass-op-base);
  --_stroke-op: var(--s-stroke-op-idle);
  --_text-op: var(--s-text-op-idle);
  --_glare-op: 0;

  @include glass-surface(var(--btn-radius));
  @extend .text-data;

  display: inline-flex;
  align-items: center;
  justify-content: center;
  height: var(--btn-h);
  padding-inline: var(--ui-p-btn);
  cursor: pointer;
  z-index: 10;
  color: rgba(var(--p-white-rgb), var(--_text-op));

  /* Системный двигатель (всегда d-fast) */
  transition: 
    background-color var(--d-fast) var(--e-out),
    box-shadow var(--d-fast) var(--e-out),
    color var(--d-fast) var(--e-out),
    backdrop-filter var(--d-fast) var(--e-out),
    border-color var(--d-fast) var(--e-out),
    transform var(--d-fast) var(--e-out); // Transform уже тут
  
  transition-delay: var(--stagger-step);

  /* [2. LOGIC: КАСКАДНЫЙ ХОВЕР (Обычные карточки)] */
  .b-static-card:hover &, .b-card:hover & {
    transition-delay: 0s; 
    --_bg-op: var(--s-glass-op-hover);
    --_stroke-op: var(--s-stroke-op-hover);
    --_text-op: var(--s-text-op-hover);
  }

  /* Ховер на саму кнопку - Всегда плавно */
  &.ui-button:hover {
    transition-delay: 0s;
    --_bg-op: var(--s-glass-op-active);
    --_stroke-op: var(--s-stroke-op-active);
    --_text-op: 1;
    --_glare-op: var(--s-glare-op-active);
  }

  /* [NEW: GLOBAL CLICK PHYSICS]
     Теперь любая кнопка в системе имеет физический отклик при нажатии */
  &:active {
    transform: scale(0.96); // Тот самый эффект сжатия
    transition-duration: 0.1s; // Мгновенный возврат (Snappy feedback)
    --_bg-op: var(--s-glass-op-active);
    --_stroke-op: var(--s-stroke-op-active);
  }

  /* ============================================================
     [FIX] ACCORDION INDEPENDENT LOGIC (Warm Start Physics)
     ============================================================ */
  .b-accordion & {
    --_bg-op: var(--s-glass-op-base);
    --_stroke-op: var(--s-stroke-op-idle);
    --_text-op: var(--s-text-op-idle);
    transition-delay: 0s;

    .b-static-card:hover & {
      --_bg-op: var(--s-glass-op-hover);
      --_stroke-op: var(--s-stroke-op-hover);
      --_text-op: var(--s-text-op-hover);
    }

    &:hover {
      --_bg-op: var(--s-glass-op-active);
      --_stroke-op: var(--s-stroke-op-active);
      --_text-op: 1;
    }
  }

  /* [3. CONTEXT: OUTSIDE / TAGS / NAVBAR] */
  &:not(.b-static-card &):not(.b-card &):not(.b-navbar &):not(#tagsContainer &) {
    --_bg-op: var(--s-glass-op-hover);
    --_stroke-op: var(--s-stroke-op-hover);
    --_text-op: var(--s-text-op-hover);
  }

  /* Логотип: специфическое начертание и чуть более глубокий клик */
  &--logo {
    width: var(--btn-h); padding: 0; aspect-ratio: 1/1;
    &:active { transform: scale(0.92); } // Логотип "тяжелее", поэтому жмется сильнее
    .b-logo { 
      position: relative; z-index: 2; display: flex; align-items: center; justify-content: center; color: inherit;
      transition: color var(--d-fast) var(--e-out), opacity var(--d-fast) var(--e-out);
      height: 40%; width: 40%; 
      svg { width: 100%; height: 100%; transform: translate3d(var(--logo-balance-x), 0, 0); }
    }
  }

  .b-navbar & {
    --btn-h: var(--nav-content-h);
    --btn-radius: var(--nav-inner-radius);
    --_blur: var(--nav-blur);
    --_bg-op: var(--s-glass-op-base);
    --_stroke-op: var(--s-stroke-op-idle);
  }

  #tagsContainer & {
    --btn-radius: 100px;
    --btn-h: calc(var(--ui-h-btn-master) * 0.9);
    padding-inline: 24px;
    transition-delay: 0s;
    --_bg-op: var(--s-glass-op-hover);
    --_stroke-op: var(--s-stroke-op-hover);
    --_glare-op: var(--s-glare-op-hover);
    --_text-op: var(--s-text-op-hover);
    &:hover, &.is-active { --_bg-op: var(--s-glass-op-active); --_stroke-op: var(--s-stroke-op-active); --_text-op: 1; }
    &.is-active { pointer-events: none; cursor: default; }
  }
}