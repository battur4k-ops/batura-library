/* ============================================================
   5-COMPONENTS / _CARD.SCSS
   Batura Library | System Synced v12.0 [Hover Cascade Edition]
   ============================================================ */

/* 
   [FIX: THE SNAP & JITTER]
   Анимация появления с фиксацией в Z-пространстве (0.1px).
   Это предотвращает микро-прыжок текста при завершении анимации.
*/
@keyframes cardItemEntrance {
  0% {
    opacity: 0.01;
    transform: translate3d(var(--entrance-offset), 0, 0.1px);
    backdrop-filter: blur(0px);
  }
  100% {
    opacity: 0.999; 
    transform: translate3d(0, 0, 0.1px);
    backdrop-filter: blur(var(--s-glass-blur));
  }
}

.b-card {
  /* 1. МАТЕРИАЛ (Scope: card) */
  @include glass-surface("card");
  @include glass-light-layer("card"); 
  
  /* 2. ГЕОМЕТРИЯ */
  flex: var(--card-grow-base) 0 10%; 
  min-width: 80px; 
  height: 100%;
  cursor: pointer;
  will-change: flex-grow;

  /* Ритм системы из _motion.scss */
  transition: 
    flex-grow var(--d-slow) var(--e-out),
    var(--t-material);

  /* --- INTERACTIONS (Hover Cascade Protocol) --- */

  /* А. Наведение на ЗАКРЫТУЮ карточку */
  &:hover:not(.is-active):not(.b-card--static) {
    --card-bg-op: var(--s-glass-op-hover);
    --card-stroke-op: var(--s-stroke-op-hover);
    --card-glare-op: 1;

    /* [CASCADE] Подсвечиваем кнопку внутри */
    .ui-button {
      --btn-bg-op: var(--s-glass-op-hover);
      --btn-stroke-op: var(--s-stroke-op-hover);
    }

    .b-card__label, .b-card__index { 
      color: rgba(var(--p-white-rgb), var(--s-text-op-hover)); 
    }
  }

  /* Б. АКТИВНОЕ СОСТОЯНИЕ (Открытая карточка) */
  &.is-active {
    flex-grow: var(--card-grow-active);
    cursor: default;

    --card-bg-op: var(--s-glass-op-active);      
    --card-stroke-op: var(--s-stroke-op-active);

    /* По умолчанию в открытой карте кнопка видна, но спокойна */
    .ui-button {
      --btn-bg-op: var(--s-glass-op-base);
      --btn-stroke-op: var(--s-stroke-op-idle);
    }

    /* [CASCADE] Если водим мышкой по ОБЛАСТИ открытой карты */
    &:hover {
      flex-grow: var(--card-grow-active-hover);
      --card-glare-op: 1;

      .ui-button {
        --btn-bg-op: var(--s-glass-op-hover);
        --btn-stroke-op: var(--s-stroke-op-hover);
      }
    }

    /* Вход контента (Stagger Logic) */
    .b-card__content {
      visibility: visible; 
      opacity: 1; 
      pointer-events: auto;
      transition: opacity var(--d-base) var(--e-out) var(--entrance-delay);
    }

    .b-card__content > * {
      animation: cardItemEntrance var(--d-base) var(--e-out) both;
      -webkit-font-smoothing: antialiased;
      
      @for $i from 1 through 8 {
        &:nth-child(#{$i}) {
          animation-delay: calc(var(--entrance-delay) + (#{$i} * var(--stagger-step)));
        }
      }
    }

    /* Мгновенный уход лейбла (v9.2 fix) */
    .b-card__label { 
        opacity: 0; 
        transition: opacity 0s; 
    }

    .b-card__index { 
      opacity: 1; 
      color: rgba(var(--p-white-rgb), var(--s-text-op-hover));
      transition-delay: var(--entrance-delay); 
    }
  }

  /* --- ВНУТРЕННЯЯ СТРУКТУРА --- */

  &__viewport {
    position: relative; 
    height: 100%; width: 100%;
    padding: var(--p-card);
    display: flex; flex-direction: column; justify-content: flex-end;
    border-radius: var(--radius-inner);
    z-index: 2;
    transform-style: preserve-3d;
    perspective: 1000px;
  }

  &__content {
    @include flow-engine; 
    width: 100%; 
    max-width: var(--card-content-width); 
    opacity: 0; 
    visibility: hidden;
  }

  &__index, &__label {
    font-family: var(--font-mono);
    font-size: var(--fs-caption);
    color: rgba(var(--p-white-rgb), var(--s-text-op-idle));
    transition: var(--t-text); 
    z-index: 10;
  }

  &__label {
    position: absolute; 
    top: 50%; left: 50%;
    /* Фикс прыжка и здесь */
    transform: translate3d(-50%, -50%, 0.1px) rotate(-90deg);
    white-space: nowrap; 
  }
}