/* ============================================================
   5-COMPONENTS / _NAVBAR.SCSS
   Batura Library | System Synced v13.8 [Search Button-Logic]
   ============================================================ */

.b-navbar {
    /* 1. LOCAL TOKENS & GEOMETRY */
    --nav-radius: var(--radius-master);
    --nav-h: var(--nav-h-start);
    --nav-w-factor: var(--nav-w-start);
    
    --nav-content-h: calc(var(--nav-h) * var(--nav-content-scale));
    --nav-pad: calc((var(--nav-h) - var(--nav-content-h)) / 2);
    --nav-inner-radius: calc(var(--nav-radius) - var(--nav-pad));

    /* 2. INTERACTION DNA (Main Bar) */
    --_bg-op: var(--s-glass-op-base);
    --_stroke-op: var(--s-stroke-op-idle);

    @include glass-surface(var(--nav-radius));
    
    /* 3. LAYOUT */
    position: fixed;
    top: var(--nav-top);
    z-index: var(--z-nav);
    inset-inline: 0;
    margin-inline: auto;
    height: var(--nav-h);
    width: calc(var(--nav-w-factor) * min(var(--stable-content-width), var(--stable-max-content)));
    padding-inline: var(--nav-pad); 
    display: flex;
    align-items: center;
    justify-content: space-between;
    
    transform: translate3d(0, 0, 0.1px); 
    backface-visibility: hidden;

    /* 4. MOTION ENGINE */
    transition: 
        height var(--d-morph) var(--e-out),
        width var(--d-morph) var(--e-out),
        background-color var(--d-fast) var(--e-out),
        border-color var(--d-fast) var(--e-out),
        backdrop-filter var(--d-morph) var(--e-out);

    /* 7. ПОИСКОВЫЙ МОДУЛЬ (ПРАВО) */
    &__search {
        display: flex;
        align-items: center;
        height: var(--nav-content-h);
        margin-left: auto;
        
        &.is-hidden { display: none; }

        input {
            @extend .text-data;
            
            /* [1. UNIFIED BUTTON PHYSICS] */
            // 1.1. Обнуляем стандартную рамку, чтобы работал inset box-shadow из миксина
            border: none; 
            
            // 1.2. Применяем твой миксин (он создаст фон и обводку через inset shadow)
            @include glass-surface(var(--nav-inner-radius));
            
            // 1.3. Инициализируем прокси-переменные как в .ui-button (Idle State)
            --_bg-op: var(--s-glass-op-base);
            --_stroke-op: var(--s-stroke-op-idle);
            --_text-op: var(--s-text-op-idle);

            height: 100%;
            width: clamp(160px, 18vw, 240px);
            padding-inline: var(--space-sm);
            
            outline: none;           
            appearance: none;        
            
            color: rgba(var(--p-white-rgb), var(--_text-op));

            /* [2. SYSTEM ENGINE] */
            transition: 
                width var(--d-slow) var(--e-out),
                background-color var(--d-fast) var(--e-out),
                box-shadow var(--d-fast) var(--e-out), // Важно для обводки миксина
                color var(--d-fast) var(--e-out);

            &::placeholder { 
                color: rgba(var(--p-white-rgb), var(--s-text-op-idle)); 
                opacity: 0.5;
            }

            /* [3. HOVER & FOCUS = ACTIVE] */
            // По твоей просьбе: при наведении ИЛИ фокусе — сразу состояние ACTIVE
            &:hover, &:focus {
                --_bg-op: var(--s-glass-op-active);
                --_stroke-op: var(--s-stroke-op-active);
                --_text-op: 1;
            }

            &:focus {
                width: clamp(220px, 25vw, 360px); 
            }
        }
    }


    /* 5. SCROLL STATE */
    body.is-scrolled & {
        --nav-h: var(--nav-h-morph);
        --nav-w-factor: var(--nav-w-morph);
        --_bg-op: var(--s-glass-op-hover); 
        --_stroke-op: var(--s-stroke-op-hover);
    }
}